# ISSUE-002: Vote grouping and counting logic duplicated in arbitrator and Results component

**Severity**: Low
**Category**: Repeated Logic
**Detected by**: cohesion-analyzer
**File**: `src/agents/arbitrator.ts:9-26`

## Description

The logic for grouping votes by issue ID and counting approvals appears in arbitrator.ts (groupVotesByIssue, countApprovals functions) and is partially re-implemented in Results.tsx (line 26: issue.votes.filter(v => v.approve).length). While not a full duplication, this suggests vote aggregation logic is scattered across the codebase rather than centralized.

## Problematic Code

```typescript
function groupVotesByIssue(votes: Vote[]): Map<string, Vote[]> {
  const grouped = new Map<string, Vote[]>();

  for (const vote of votes) {
    const existing = grouped.get(vote.issueId) ?? [];
    existing.push(vote);
    grouped.set(vote.issueId, existing);
  }

  return grouped;
}

function countApprovals(votes: Vote[]): number {
  return votes.filter(v => v.approve).length;
}
```

## Recommendation

Consider creating a shared vote utility module (e.g., src/utils/votes.ts) that exports functions like groupVotesByIssue, countApprovals, and getVoteCount. This makes vote-related operations consistent across the codebase.

## Voting Summary

**Result**: 3/3 votes to approve

- **Voter 1**: Approved - "Genuine issue. The vote counting logic (filter for approve) appears in 3 places: arbitrator.ts countApprovals (line 25), arbitrator.ts getArbitrationSummary (line 104), and Results.tsx (line 26). While the duplication is minimal, centralizing this logic in a shared utility would improve maintainability and consistency. The severity 'low' is appropriate since the duplication is small but the recommendation is valid."
- **Voter 2**: Approved - "This is a genuine issue. The vote counting logic `votes.filter(v => v.approve).length` appears in 4 different locations: arbitrator.ts (lines 25, 104), Results.tsx (line 26), and tickets.ts (line 120). While `countApprovals` is defined in arbitrator.ts, it's only used internally and the inline filter is duplicated elsewhere including within the same file (line 104). Creating a shared utility module would improve maintainability and consistency. The severity of 'low' is appropriate as this is a minor code quality issue that doesn't affect functionality."
- **Voter 3**: Approved - "Genuine issue. The vote counting logic `issue.votes.filter(v => v.approve).length` is duplicated in three places: arbitrator.ts line 24-26 (countApprovals function), line 104 (in getArbitrationSummary), and Results.tsx line 26. This scattered logic could lead to inconsistencies if the counting logic needs to change. Creating a shared utility module would improve maintainability and ensure consistency. The severity is appropriately marked as low since it's a code quality issue, not a functional bug."

---
*Generated by Rover on December 12, 2025*