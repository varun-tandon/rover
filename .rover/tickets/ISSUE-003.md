# ISSUE-003: Agent result aggregation logic repeated in batch-runner

**Severity**: Low
**Category**: Repeated Logic
**Detected by**: cohesion-analyzer
**File**: `src/agents/batch-runner.ts:219-233`

## Description

In batch-runner.ts (lines 219-233), there are four separate reduce operations to calculate aggregate statistics (totalCandidateIssues, totalApprovedIssues, totalRejectedIssues, totalTickets). This same pattern of iterating over agentResults could be done in a single pass for better performance and cleaner code.

## Problematic Code

```typescript
const totalCandidateIssues = agentResults.reduce(
  (sum, r) => sum + r.scanResult.issues.length, 0
);
const totalApprovedIssues = agentResults.reduce(
  (sum, r) => sum + r.arbitratorResult.approvedIssues.length, 0
);
const totalRejectedIssues = agentResults.reduce(
  (sum, r) => sum + r.arbitratorResult.rejectedIssues.length, 0
);
const totalTickets = agentResults.reduce(
  (sum, r) => sum + r.arbitratorResult.ticketsCreated.length, 0
);
const totalCostUsd = agentResults.reduce(
  (sum, r) => r.scanResult.costUsd + r.voterResults.reduce((vs, v) => vs + v.costUsd, 0) + sum, 0
);
```

## Recommendation

Combine the four separate reduce operations into a single reduce that calculates all aggregates in one pass. This improves performance (O(n) instead of O(4n)) and makes the aggregation logic more cohesive.

## Voting Summary

**Result**: 3/3 votes to approve

- **Voter 1**: Approved - "The issue is genuine. Lines 219-233 contain five separate reduce operations over the same agentResults array (including totalCostUsd which was also in the snippet). Combining these into a single reduce would improve performance from O(5n) to O(n) and improve code cohesion. The recommendation is practical and would make the code cleaner without introducing complexity. The severity of 'low' is appropriate since this is a performance and maintainability improvement rather than a critical bug."
- **Voter 2**: Approved - "The issue is genuine. Lines 219-233 contain 5 separate reduce operations over the same agentResults array. This is inefficient (O(5n) vs O(n)) and could be easily refactored into a single reduce that calculates all aggregates in one pass. The code is readable but unnecessarily wasteful. The severity of 'low' is appropriate since it's not a bug, just a performance and code quality improvement. The fix would improve both performance and maintainability without any downside."
- **Voter 3**: Approved - "Issue is genuine and valid. Lines 219-233 contain 5 separate reduce operations over the same agentResults array, which is inefficient O(5n) complexity. The recommendation to combine into a single reduce pass O(n) is sound, improves performance, enhances code cohesion, and makes the aggregation logic more maintainable. The severity 'low' is appropriate as this is a performance/quality improvement rather than a bug."

---
*Generated by Rover on December 12, 2025*